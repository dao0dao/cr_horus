<div class="container">
  <div class="d-flex my-4 justify-content-between align-items-center">
    <h1>{{commonStrings.header.label}}</h1>
    <button class="btn btn-primary mx-3" (click)="openModal()">{{commonStrings.header.buttonLabel}}</button>
  </div>

  <div class="card p-3 mb-4">
    <div class="row g-3 align-items-end">
      <div class="col-md-4">
        <label class="form-label fw-bold">{{commonStrings.filters.nameFilter.label}}</label>
        <input
          type="text"
          class="form-control"
          placeholder="{{commonStrings.filters.nameFilter.placeholder}}"
          [(ngModel)]="filters.name"
        />
      </div>

      <div class="col-md-4">
        <label class="form-label fw-bold">{{commonStrings.filters.dateFilter.label}}</label>
        <input
          type="date"
          class="form-control"
          [(ngModel)]="filters.date"
        />
      </div>

      <div class="col-md-4">
        <label class="form-label fw-bold">{{ commonStrings.filters.statusFilter.label }}</label>
        <select class="form-select" [(ngModel)]="filters.status">
          <option value="">{{ commonStrings.filters.statusFilter.allOption}}</option>
          <option value="Completed">{{ commonStrings.filters.statusFilter.completedOption}}</option>
          <option value="Pending">{{commonStrings.filters.statusFilter.pendingOption}}</option>
          <option value="Planned">{{commonStrings.filters.statusFilter.plannedOption}}</option>
        </select>
      </div>
    </div>
  </div>

  <ul class="list-group">
    @for (task of filteredTasks(); track task.id) {
      <li class="list-group-item">
        <div class="d-flex flex-column">
          <div class="d-flex align-items-center justify-content-between">
            <div class="d-flex align-items-center">
              <input
                type="checkbox"
                [id]="'task-' + task.id"
                class="form-check-input me-2"
                [checked]="task.status === 'Completed'"
                (change)="toggleTaskStatus(task.id)"
              />
              <label
                [for]="'task-' + task.id"
                [ngClass]="{ 'text-decoration-line-through text-muted': task.status === 'Completed' }"
                class="fw-bold"
              >
                {{ task.name }}
              </label>
            </div>

            <div>
              <span class="badge bg-info me-2">{{ task.status }}</span>
              <button class="btn btn-link p-0" (click)="toggleDescription(task)">
                {{ task.showDescription ? 'ukryj opis' : 'pokaż opis' }}
              </button>
            </div>
          </div>

          <small class="text-secondary">{{ task.date }}</small>

          @if (task.showDescription) {
            <p class="mt-2 mb-0">{{ task.description }}</p>
          }
        </div>
      </li>
    }
  </ul>
</div>

@if (isModalOpen) {
  <div class="modal-backdrop" (click)="closeModal()"></div>

  <div class="modal-dialog">
    <div class="modal-content p-4">
      <h4 class="mb-3">{{commonStrings.newTask.title}}</h4>

      <form [formGroup]="taskForm" (ngSubmit)="addTask()">
        <div class="mb-3">
          <label class="form-label fw-bold">{{commonStrings.newTask.form.nameInput.label}}</label>
          <input type="text" class="form-control" formControlName="name" placeholder="np. Umówić wizytę u dentysty" />
          @if (taskForm.get('name')?.touched && taskForm.get('name')?.invalid) {
            <div class="text-danger mt-1 small">{{commonStrings.newTask.form.nameInput.errorRequired}}</div>
          }
        </div>

        <div class="mb-3">
          <label class="form-label fw-bold">{{commonStrings.newTask.form.dateInput.label}}</label>
          <input type="date" class="form-control" formControlName="date" />
          @if (taskForm.get('date')?.touched && taskForm.get('date')?.errors?.['required']) {
            <div class="text-danger mt-1 small">{{commonStrings.newTask.form.dateInput.errorRequired}}</div>
          }
          @if (taskForm.get('date')?.touched && taskForm.get('date')?.errors?.['pastDate']) {
            <div class="text-danger mt-1 small">{{commonStrings.newTask.form.dateInput.errorPastDate}}</div>
          }
        </div>

        <div class="mb-3">
          <label class="form-label fw-bold">{{commonStrings.newTask.form.descriptionInput}}</label>
          <textarea class="form-control" formControlName="description" rows="3"></textarea>
        </div>

        <div class="text-end">
          <button type="button" class="btn btn-secondary me-2" (click)="closeModal()">{{commonStrings.actions.cancel}}</button>
          <button type="submit" class="btn btn-primary" [disabled]="taskForm.invalid">{{commonStrings.actions.save}}</button>
        </div>
      </form>
    </div>
  </div>
}
